<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vox Analyzer - Porpora</title>
    <style>
        :root {
            --bg-color: #121214;
            --surface-color: #202024;
            --surface-hover: #29292e;
            --stroke-color: #323238;
            --primary: #8257e5;  
            --accent: #04d361;
            --danger: #e96379;
            --warning: #fba94c;
            --text-primary: #e1e1e6;
            --text-secondary: #a8a8b3;
        }

        body { 
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-color); 
            color: var(--text-primary); 
            margin: 0; padding: 0;
            height: 100vh;
            display: flex; flex-direction: column; overflow: hidden; 
        }

        /* HEADER */
        header {
            background: var(--surface-color);
            padding: 0 1.5rem; height: 60px;
            border-bottom: 1px solid var(--stroke-color);
            display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.1rem; font-weight: 600; letter-spacing: -0.5px; }
        #status { font-size: 0.85rem; color: var(--text-secondary); font-family: monospace;}

        /* TOOLBAR */
        .controls {
            padding: 0.8rem 1.5rem;
            background: var(--bg-color);
            border-bottom: 1px solid var(--stroke-color);
            display: flex; align-items: center; gap: 15px; flex-wrap: wrap; flex-shrink: 0; z-index: 20;
        }
        .btn-group { display: flex; gap: 8px; }

        button {
            background: var(--surface-color); color: var(--text-primary); border: 1px solid var(--stroke-color);
            padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s;
            font-weight: 500; display: flex; align-items: center; gap: 6px; white-space: nowrap;
        }
        button:hover:not(:disabled) { background: var(--surface-hover); border-color: var(--text-secondary); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #startBtn { background: var(--primary); border-color: var(--primary); color: #fff; }
        #startBtn:hover:not(:disabled) { filter: brightness(1.1); }
        #stopBtn:enabled { background: rgba(233, 99, 121, 0.1); color: var(--danger); border-color: var(--danger); }
        #stopBtn:hover:enabled { background: var(--danger); color: #fff; }
        #analyzeBtn.active { background: #fff; color: #000; border-color: #fff; }

        /* CHECKBOX */
        .checkbox-wrapper {
            display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary);
            cursor: pointer; padding: 6px 12px; border-radius: 6px; border: 1px solid transparent; user-select: none;
        }
        .checkbox-wrapper:hover { background: var(--surface-color); }
        .checkbox-wrapper input { accent-color: var(--accent); width: 16px; height: 16px; }

        /* --- CUSTOM AUDIO PLAYER (Estilo Moderno) --- */
        .custom-player {
            flex-grow: 1;
            display: flex; align-items: center; gap: 12px;
            background: var(--surface-color);
            padding: 6px 15px; border-radius: 50px;
            border: 1px solid var(--stroke-color);
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            max-width: 500px;
        }
        .custom-player.visible { opacity: 1; pointer-events: auto; }
        
        #playPauseBtn {
            border: none; background: var(--text-primary); color: var(--bg-color);
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            padding: 0; font-size: 14px;
        }
        #playPauseBtn:hover { transform: scale(1.05); }

        .progress-container { flex-grow: 1; height: 4px; background: #333; border-radius: 2px; cursor: pointer; position: relative; }
        .progress-fill { 
            height: 100%; width: 0%; background: var(--accent); border-radius: 2px; 
            position: relative; transition: width 0.1s linear; /* Suave */
        }
        /* Bolinha na ponta da barra de progresso */
        .progress-fill::after {
            content: ''; position: absolute; right: -4px; top: -3px;
            width: 10px; height: 10px; background: #fff; border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            opacity: 0; transition: opacity 0.2s;
        }
        .progress-container:hover .progress-fill::after { opacity: 1; }

        .time-display { font-size: 0.75rem; font-family: monospace; color: var(--text-secondary); min-width: 80px; text-align: right; }

        /* MENU MICROFONE */
        .mic-menu {
            position: absolute; top: 110px; left: 20px;
            background: var(--surface-color); border: 1px solid var(--stroke-color);
            padding: 15px; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            z-index: 100; min-width: 280px; display: flex; flex-direction: column; gap: 8px;
        }
        .mic-menu.hidden { display: none; }
        select { width: 100%; padding: 8px; background: var(--bg-color); color: #fff; border: 1px solid var(--stroke-color); border-radius: 4px; }

        /* MAIN STAGE */
        .main-stage {
            flex-grow: 1; position: relative; background: #09090a; overflow: hidden;
            display: flex; flex-direction: column;
        }
        .canvas-wrapper { width: 100%; height: 100%; position: relative; }
        canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }

        /* HUD */
        .hud-overlay {
            position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; pointer-events: none;
            display: flex; justify-content: space-between; align-items: flex-end;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }
        .note-badge {
            background: rgba(32, 32, 36, 0.9); backdrop-filter: blur(4px);
            padding: 10px 25px; border-radius: 12px; border: 1px solid var(--stroke-color); text-align: center;
        }
        .note-badge h2 { margin: 0; font-size: 3rem; color: var(--text-primary); line-height: 1; }
        .note-badge span { font-size: 0.9rem; color: var(--text-secondary); }

        .metrics-panel {
            background: rgba(32, 32, 36, 0.9); padding: 15px; border-radius: 8px;
            font-family: monospace; font-size: 0.8rem; color: var(--text-secondary); border: 1px solid var(--stroke-color);
        }
        .metric-val { color: var(--text-primary); font-weight: bold; float: right; margin-left: 15px; }

        .volume-indicator { position: absolute; top: 0; left: 0; bottom: 0; width: 4px; background: rgba(255,255,255,0.05); }
        #volumeBar { position: absolute; bottom: 0; left: 0; width: 100%; background: var(--accent); transition: height 0.05s; }
    </style>
</head>
<body>

    <header>
        <h1>Vox Analyzer <span style="font-weight:400; opacity:0.5; font-size: 0.8em;">| Porpora Project</span></h1>
        <div id="status">Pronto</div>
    </header>

    <div class="controls">
        <div class="btn-group">
            <button id="configBtn">‚öôÔ∏è</button>
            <button id="startBtn">‚ñ∂ Iniciar</button>
            <button id="stopBtn" disabled>‚èπ Parar</button>
            <button id="analyzeBtn" disabled>üëÅÔ∏è Precis√£o</button>
        </div>

        <label class="checkbox-wrapper">
            <input type="checkbox" id="recordToggle">
            <span>Gravar √Åudio</span>
        </label>

        <div id="customPlayer" class="custom-player">
            <audio id="audioPlayer" style="display:none;"></audio>
            
            <button id="playPauseBtn">‚ñ∂</button>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="time-display">
                <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
            </div>
        </div>

        <div id="scaleDisplay" style="margin-left: auto; font-weight: bold; color: var(--primary); font-size: 0.9rem;">
            --
        </div>
    </div>

    <div id="micMenu" class="mic-menu hidden">
        <label>Microfone:</label>
        <select id="audioSource">
            <option value="">Padr√£o</option>
        </select>
    </div>

    <div class="main-stage">
        <div class="canvas-wrapper">
            <canvas id="pitchGraph"></canvas>
        </div>
        
        <div class="hud-overlay">
            <div class="volume-indicator">
                <div id="volumeBar" style="height: 0%;"></div>
            </div>
            <div class="note-badge">
                <h2 id="noteName">--</h2>
                <span id="centsDisplay">0 cents</span>
            </div>
            <div class="metrics-panel">
                <div>Freq: <span class="metric-val" id="freq">0.0 Hz</span></div>
                <div>MIDI: <span class="metric-val" id="midi">0.0</span></div>
                <div>Erro: <span class="metric-val" id="error">0</span></div>
            </div>
        </div>
    </div>

    <script src="../build/vox_engine.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>